name: Test LogMaster

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Make executable
      run: chmod +x logmaster
    
    - name: Test help
      run: ./logmaster --help
    
    - name: Test version
      run: ./logmaster --version
    
    - name: Create test log
      run: |
        echo "[2024-12-15 10:00:00] INFO: Application started" > test.log
        echo "[2024-12-15 10:01:00] ERROR: Database connection failed" >> test.log
        echo "[2024-12-15 10:02:00] WARN: Slow query detected" >> test.log
        echo "[2024-12-15 10:03:00] ERROR: API timeout" >> test.log
    
    - name: Test analyze
      run: ./logmaster analyze test.log
    
    - name: Test errors
      run: ./logmaster errors test.log
    
    - name: Test warnings
      run: ./logmaster warnings test.log
    
    - name: Test stats
      run: ./logmaster stats test.log
    
    - name: Test search
      run: ./logmaster search test.log "Database"
    
    - name: Shellcheck
      run: sudo apt-get install -y shellcheck && shellcheck logmaster || true
    
    - name: Structure check
      run: |
        grep -q "analyze_log()" logmaster
        grep -q "show_errors()" logmaster
        grep -q "show_warnings()" logmaster
        grep -q "generate_stats()" logmaster
